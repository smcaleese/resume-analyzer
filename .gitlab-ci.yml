stages:
  - build
  - test
# TODO Create custom docker image with pythoin and newman
image: tiangolo/uvicorn-gunicorn-fastapi:latest

build_project:
  stage: build
  script:
    - cd src/backend
    - python -V
    - pip install -r requirements.txt
    - uvicorn server:app &
    - ps aux | grep -i "[u]vicorn" | awk {'print $2'} | xargs kill -9

postman_tests:
  stage: test
  image: 
    name: eranelion/newman-python
    entrypoint: [""]
  script:
    - cd src/backend
    - newman --version
    - python -V
    - pip install --upgrade pip
    - pip install -r requirements.txt
    - uvicorn server:app &
    - cd ../tests/postman
    - ps aux
    - newman run status.postman_collection.json --reporters cli
    - ps aux | grep -i "[u]vicorn" | awk {'print $2'} | xargs kill -9


