stages:
  - build
  - test
  - cleanup

image: tiangolo/uvicorn-gunicorn-fastapi:latest

build_project:
  stage: build
  script:
    - cd src/backend
    - python -V
    - pip install -r requirements.txt
    - uvicorn server:app &

postman_tests:
  stage: test
  image: 
    name: postman/newman_alpine33
    entrypoint: [""]
  script:
    - cd src/tests/postman
    - newman --version
    - ps aux
    - newman run status.postman_collection.json --reporters cli

cleanup:
  stage: cleanup
  script:
    - ps aux | grep -i "[u]vicorn" | awk {'print $2'} | xargs kill -9


